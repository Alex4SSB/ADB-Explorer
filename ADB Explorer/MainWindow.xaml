<Window
    x:Class="ADB_Explorer.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:app_prop="clr-namespace:ADB_Explorer.Properties"
    xmlns:controls="clr-namespace:ADB_Explorer.Controls"
    xmlns:converters="clr-namespace:ADB_Explorer.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:emoji="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf"
    xmlns:helpers="clr-namespace:ADB_Explorer.Helpers"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:ADB_Explorer.Models"
    xmlns:resources="clr-namespace:ADB_Explorer.Resources"
    xmlns:strings="clr-namespace:ADB_Explorer.Strings"
    xmlns:sys="clr-namespace:System;assembly=System.Runtime"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    xmlns:views="clr-namespace:ADB_Explorer.Views"
    x:Name="MainWin"
    Width="800"
    Height="450"
    MinWidth="605"
    MinHeight="400"
    ui:ThemeManager.IsThemeAware="True"
    ui:WindowHelper.UseModernWindowStyle="True"
    Background="{DynamicResource AdbWindowBackground}"
    Closing="Window_Closing"
    Cursor="{Binding ElementName=UnfinishedBlock, Path=Cursor}"
    LocationChanged="MainWin_LocationChanged"
    MouseDown="Window_MouseDown"
    MouseUp="Window_MouseUp"
    PreviewKeyDown="MainWin_PreviewKeyDown"
    PreviewKeyUp="MainWindow_OnPreviewKeyUp"
    PreviewQueryContinueDrag="MainWindow_OnPreviewQueryContinueDrag"
    SizeChanged="Window_SizeChanged"
    SourceInitialized="Window_SourceInitialized"
    StateChanged="MainWin_StateChanged"
    Style="{StaticResource WindowStyle}"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Window.Resources>
        <sys:Int16 x:Key="FontSize">13</sys:Int16>
        <CollectionViewSource x:Key="FileListView" Source="{Binding Source={x:Static Member=models:Data.DirList}, Path=FileList}" />
        <ContextMenu x:Key="RowContextMenu" Style="{StaticResource ExplorerContextMenuStyle}" />
        <converters:StringFormatConverter x:Key="StringFormatConverter" />
        <Style
            x:Key="DataGridCellStyle"
            BasedOn="{StaticResource BaseCellStyle}"
            TargetType="{x:Type DataGridCell}">
            <EventSetter Event="RequestBringIntoView" Handler="DataGridCell_RequestBringIntoView" />
            <EventSetter Event="PreviewMouseDown" Handler="DataGridCell_PreviewMouseDown" />
            <EventSetter Event="MouseUp" Handler="DataGridCell_MouseUp" />
        </Style>
        <Style
            x:Key="RowStyle"
            BasedOn="{StaticResource BaseRowStyle}"
            TargetType="DataGridRow">
            <Setter Property="ContextMenu" Value="{StaticResource RowContextMenu}" />
            <EventSetter Event="MouseDown" Handler="DataGridRow_MouseDown" />
            <EventSetter Event="MouseDoubleClick" Handler="DataGridRow_MouseDoubleClick" />
            <EventSetter Event="KeyDown" Handler="DataGridRow_KeyDown" />
            <EventSetter Event="Drop" Handler="DataGridRow_Drop" />
            <EventSetter Event="MouseUp" Handler="DataGridCell_MouseUp" />
            <EventSetter Event="DragOver" Handler="ExplorerGrid_DragOver" />
        </Style>
        <Style
            x:Key="SettingsComboboxStyle"
            BasedOn="{StaticResource FluentComboBoxStyle}"
            TargetType="ComboBox">
            <EventSetter Event="PreviewMouseWheel" Handler="ComboBox_PreviewMouseWheel" />
        </Style>
        <Style BasedOn="{StaticResource TextBlockStyle}" TargetType="TextBlock" />
    </Window.Resources>
    <Window.TaskbarItemInfo>
        <TaskbarItemInfo ProgressValue="{Binding ElementName=UpperProgressBar, Path=Value}" />
    </Window.TaskbarItemInfo>
    <Grid Margin="0,2,0,0">
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
                <RowDefinition />
                <RowDefinition Height="Auto" />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Grid Margin="0,0,7,0">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <Menu x:Name="MainToolBar" Style="{StaticResource MainToolBarStyle}" />
                <Border
                    Grid.Column="1"
                    Background="Transparent"
                    MouseDown="Window_MouseDown" />
                <StackPanel
                    Grid.Column="2"
                    HorizontalAlignment="Right"
                    Orientation="Horizontal">
                    <Menu Style="{StaticResource FileOpMenuStyle}" />
                    <Menu Style="{StaticResource SettingsMenuStyle}" />
                </StackPanel>
            </Grid>
            <Grid Grid.Row="1" MouseEnter="Grid_MouseEnter">
                <StackPanel Margin="0,4,0,2">
                    <Separator />
                    <Grid Margin="6,2">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <Menu
                            x:Name="NavigationToolBar"
                            Margin="0,0,6,0"
                            Style="{StaticResource MainToolBarStyle}" />
                        <controls:NavigationBox x:Name="NavigationBox" Grid.Column="1" />
                        <controls:SearchBox
                            x:Name="SearchBox"
                            Grid.Column="2"
                            Height="34"
                            IsExpanded="{Binding Source={x:Static Member=models:Data.RuntimeSettings}, Path=IsSearchBoxFocused, Mode=TwoWay}"
                            Style="{StaticResource SearchBoxStyle}" />
                    </Grid>
                </StackPanel>
                <ui:ProgressBar
                    x:Name="UpperProgressBar"
                    VerticalAlignment="Bottom"
                    CornerRadius="0"
                    LargeChange="0.001"
                    Maximum="1"
                    SmallChange="0.0001"
                    Style="{StaticResource UpperProgressBarStyle}" />
            </Grid>
            <Border
                x:Name="GridBackgroundBlock"
                Grid.Row="2"
                MouseDown="GridBackgroundBlock_MouseDown"
                Style="{StaticResource ExplorerViewBackgroundStyle}">
                <Grid>
                    <ScrollViewer Style="{StaticResource DriveViewScrollViewerStyle}">
                        <StackPanel>
                            <Expander
                                Margin="4"
                                helpers:ExpanderHelper.IsTransparent="True"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_SAVED_LOCATIONS}}"
                                IsExpanded="{Binding Source={x:Static Member=models:Data.Settings}, Path=HomeLocationsExpanded, Mode=TwoWay}">
                                <ListView x:Name="HomeSavedLocationsList" Style="{StaticResource HomeSavedLocationsListStyle}" />
                            </Expander>
                            <Expander
                                Margin="4"
                                helpers:ExpanderHelper.IsTransparent="True"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_BUTTON_DRIVES}}"
                                IsExpanded="True">
                                <ListView x:Name="DriveList" Style="{StaticResource DriveListViewStyle}" />
                            </Expander>
                        </StackPanel>
                    </ScrollViewer>
                    <DataGrid
                        x:Name="ExplorerGrid"
                        helpers:SelectionHelper.CurrentSelectedIndex="-1"
                        helpers:SelectionHelper.FirstSelectedIndex="-1"
                        helpers:SelectionHelper.SelectionInProgress="False"
                        AutoGenerateColumns="False"
                        Background="Transparent"
                        CanUserResizeRows="False"
                        CellStyle="{StaticResource DataGridCellStyle}"
                        ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
                        ContextMenu="{StaticResource RowContextMenu}"
                        ContextMenuClosing="ExplorerGrid_ContextMenuClosing"
                        ContextMenuOpening="ExplorerGrid_ContextMenuOpening"
                        DragOver="ExplorerGrid_DragOver"
                        Drop="DataGridRow_Drop"
                        GridLinesVisibility="None"
                        HeadersVisibility="Column"
                        IsReadOnly="False"
                        ItemsSource="{Binding Source={StaticResource FileListView}, NotifyOnSourceUpdated=True}"
                        KeyboardNavigation.TabNavigation="Once"
                        MouseDown="ExplorerGrid_MouseDown"
                        MouseMove="ExplorerGrid_MouseMove"
                        RowStyle="{StaticResource RowStyle}"
                        SelectedItem="{Binding SelectedRow, Mode=TwoWay}"
                        SelectionChanged="ExplorerGrid_SelectionChanged"
                        SelectionMode="Extended"
                        SelectionUnit="FullRow"
                        Sorting="ExplorerGrid_Sorting"
                        Style="{StaticResource ExplorerGridStyle}">
                        <DataGrid.Columns>
                            <DataGridTemplateColumn
                                x:Name="IconColumn"
                                MaxWidth="24"
                                CanUserResize="False"
                                CellTemplate="{StaticResource FileIconTemplate}"
                                IsReadOnly="True">
                                <DataGridTemplateColumn.HeaderStyle>
                                    <Style BasedOn="{StaticResource DataGridColumnHeaderStyle}" TargetType="DataGridColumnHeader">
                                        <Setter Property="ToolTip" Value="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_ICON}}" />
                                    </Style>
                                </DataGridTemplateColumn.HeaderStyle>
                            </DataGridTemplateColumn>
                            <DataGridTemplateColumn
                                x:Name="NameColumn"
                                Width="300"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_NAME}}"
                                IsReadOnly="{Binding Source={x:Static Member=models:Data.FileActions}, Path=NameReadOnly}"
                                SortMemberPath="FullName">
                                <DataGridTemplateColumn.CellEditingTemplate>
                                    <DataTemplate>
                                        <TextBox
                                            KeyDown="NameColumnEdit_KeyDown"
                                            Loaded="NameColumnEdit_Loaded"
                                            LostFocus="NameColumnEdit_LostFocus"
                                            Style="{StaticResource FileNameEditingElementStyle}"
                                            TextChanged="NameColumnEdit_TextChanged" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellEditingTemplate>
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <emoji:TextBlock Style="{StaticResource DirectoryGridCellStyle}" Text="{Binding DisplayName}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn
                                x:Name="OriginalPath"
                                Width="180"
                                Binding="{Binding TrashIndex.ParentPath}"
                                ElementStyle="{StaticResource DirectoryGridCellStyle}"
                                FontSize="{Binding Source={StaticResource FontSize}}"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_ORIGINAL_LOCATION}}"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                x:Name="DateColumn"
                                Width="Auto"
                                FontSize="{Binding Source={StaticResource FontSize}}"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_DATE_MODIFIED}}"
                                IsReadOnly="True"
                                SortMemberPath="ModifiedTime">
                                <DataGridTextColumn.ElementStyle>
                                    <Style BasedOn="{StaticResource DirectoryGridCellStyle}" TargetType="TextBlock">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Setter Property="Text" Value="{Binding ModifiedTimeString}" />
                                        <Style.Triggers>
                                            <DataTrigger Binding="{Binding Type}" Value="File">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                            <DataTrigger Binding="{Binding Type}" Value="Folder">
                                                <Setter Property="Visibility" Value="Visible" />
                                            </DataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTemplateColumn
                                x:Name="TypeColumn"
                                Width="150"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_TYPE}}"
                                IsReadOnly="True"
                                SortMemberPath="TypeName">
                                <DataGridTemplateColumn.CellTemplate>
                                    <DataTemplate>
                                        <emoji:TextBlock
                                            FontSize="{Binding Source={StaticResource FontSize}}"
                                            Style="{StaticResource DirectoryGridCellStyle}"
                                            Text="{Binding TypeName}" />
                                    </DataTemplate>
                                </DataGridTemplateColumn.CellTemplate>
                            </DataGridTemplateColumn>
                            <DataGridTextColumn
                                x:Name="SizeColumn"
                                Width="Auto"
                                FontSize="{Binding Source={StaticResource FontSize}}"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_SIZE}}"
                                IsReadOnly="True"
                                SortMemberPath="Size">
                                <DataGridTextColumn.ElementStyle>
                                    <Style BasedOn="{StaticResource DirectoryGridCellStyle}" TargetType="TextBlock">
                                        <Setter Property="Text" Value="{Binding SizeString}" />
                                        <Setter Property="HorizontalAlignment" Value="Right" />
                                        <Setter Property="Visibility" Value="Collapsed" />
                                        <Style.Triggers>
                                            <MultiDataTrigger>
                                                <MultiDataTrigger.Conditions>
                                                    <Condition Binding="{Binding Type}" Value="File" />
                                                    <Condition Binding="{Binding IsLink}" Value="False" />
                                                </MultiDataTrigger.Conditions>
                                                <Setter Property="Visibility" Value="Visible" />
                                            </MultiDataTrigger>
                                        </Style.Triggers>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn
                                x:Name="OriginalDate"
                                Width="Auto"
                                Binding="{Binding TrashIndex.ModifiedTimeString}"
                                ElementStyle="{StaticResource DirectoryGridCellStyle}"
                                FontSize="{Binding Source={StaticResource FontSize}}"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_DATE_DELETED}}"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                x:Name="PackageName"
                                Width="400"
                                Binding="{Binding Name}"
                                ElementStyle="{StaticResource ExplorerGridCellStyle}"
                                FontSize="{Binding Source={StaticResource FontSize}}"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_NAME}}"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                x:Name="PackageType"
                                Width="100"
                                Binding="{Binding Type}"
                                ElementStyle="{StaticResource ExplorerGridCellStyle}"
                                FontSize="{Binding Source={StaticResource FontSize}}"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_TYPE}}"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                x:Name="PackageUid"
                                Width="100"
                                Binding="{Binding Uid}"
                                ElementStyle="{StaticResource ExplorerGridCellStyle}"
                                FontSize="{Binding Source={StaticResource FontSize}}"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_USER_ID}}"
                                IsReadOnly="True" />
                            <DataGridTextColumn
                                x:Name="PackageVersion"
                                Width="100"
                                Binding="{Binding Version}"
                                ElementStyle="{StaticResource ExplorerGridCellStyle}"
                                FontSize="{Binding Source={StaticResource FontSize}}"
                                Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_VERSION}}"
                                IsReadOnly="True" />
                        </DataGrid.Columns>
                    </DataGrid>
                    <Canvas x:Name="ExplorerCanvas" PreviewMouseUp="ExplorerCanvas_PreviewMouseUp">
                        <Border
                            x:Name="SelectionRect"
                            MouseMove="ExplorerGrid_MouseMove"
                            Style="{StaticResource SelectionBorderStyle}"
                            Visibility="Collapsed" />
                        <controls:RenameTooltip x:Name="RenameTooltip" Visibility="Hidden" />
                    </Canvas>
                    <Grid
                        x:Name="PasteGrid"
                        Margin="0,34,20,0"
                        HorizontalAlignment="Right"
                        VerticalAlignment="Top">
                        <controls:PasteAndPullTooltip x:Name="PasteTooltip" />
                    </Grid>
                    <Grid>
                        <Grid.Style>
                            <Style TargetType="Grid">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Source={x:Static Member=models:Data.FileActions}, Path=IsEditorOpen}" Value="False">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </Grid.Style>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                            <ColumnDefinition
                                Width="0.3*"
                                MinWidth="90"
                                MaxWidth="{Binding Source={x:Static Member=models:Data.RuntimeSettings}, Path=MaxSearchBoxWidth}" />
                        </Grid.ColumnDefinitions>
                        <Grid Grid.Column="2">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <Border Style="{StaticResource EditorControlsBorderStyle}">
                                    <Grid Style="{StaticResource EditorGridStyle}">
                                        <Grid.ColumnDefinitions>
                                            <ColumnDefinition Width="Auto" />
                                            <ColumnDefinition />
                                        </Grid.ColumnDefinitions>
                                        <Menu Margin="4" Style="{StaticResource EditorControlsMenuStyle}" />
                                        <TextBox
                                            Grid.Column="1"
                                            MinHeight="30"
                                            Style="{StaticResource EditorFilePathStyle}" />
                                    </Grid>
                                </Border>
                                <controls:MaskedTextBox Grid.Row="1" Style="{StaticResource EditorTextBoxStyle}" />
                            </Grid>
                        </Grid>
                        <GridSplitter
                            Grid.Column="1"
                            Width="6"
                            Margin="0,0,-2,0"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Stretch"
                            Background="Transparent"
                            Cursor="SizeWE"
                            FocusVisualStyle="{x:Null}" />
                    </Grid>
                    <Grid Style="{StaticResource LogGridStyle}">
                        <TextBox x:Name="LogTextBox" Style="{StaticResource LogTextBoxStyle}" />
                        <Menu
                            x:Name="LogControlsPanel"
                            Margin="18,6"
                            Style="{StaticResource LogControlsPanelStyle}" />
                    </Grid>
                    <Grid Margin="0,40" Style="{StaticResource EmptyFolderGridStyle}">
                        <StackPanel Style="{StaticResource NonRootEmptyFolderStyle}">
                            <TextBlock
                                helpers:TextHelper.AltText="{Binding Source={x:Static Member=strings:Resources.S_NON_ROOT_EMPTY_FOLDER}}"
                                Loaded="EmptyNonRootTextBlock_Loaded"
                                TextAlignment="Center" />
                        </StackPanel>
                        <TextBlock Style="{StaticResource EmptyFolderAltPromptStyle}" />
                    </Grid>
                </Grid>
            </Border>
            <Expander
                Grid.Row="4"
                Margin="0,0,0,-3"
                Padding="0,2"
                helpers:ExpanderHelper.ExpanderArrow="None"
                helpers:ExpanderHelper.IsHeaderVisible="False"
                ExpandDirection="Up"
                Style="{StaticResource ExtendedViewFileOpExpanderStyle}">
                <Grid x:Name="FileOpDetailedGrid" IsVisibleChanged="FileOpDetailedGrid_IsVisibleChanged">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition />
                    </Grid.RowDefinitions>
                    <GridSplitter
                        x:Name="FileOpDetailedSplitter"
                        Height="3"
                        Margin="0,-2,0,0"
                        HorizontalAlignment="Stretch"
                        VerticalAlignment="Top"
                        Background="Gray"
                        DragDelta="GridSplitter_DragDelta"
                        FocusVisualStyle="{x:Null}" />
                    <Grid Grid.Row="1">
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition />
                            <ColumnDefinition Width="Auto" />
                        </Grid.ColumnDefinitions>
                        <DataGrid
                            x:Name="CurrentOperationDetailedDataGrid"
                            CellStyle="{StaticResource BaseCellStyle}"
                            ColumnDisplayIndexChanged="CurrentOperationDetailedDataGrid_ColumnDisplayIndexChanged"
                            ColumnHeaderStyle="{StaticResource FileOpColumnHeaderStyle}"
                            ItemsSource="{Binding}"
                            KeyUp="CurrentOperationDetailedDataGrid_KeyUp"
                            PreviewMouseWheel="ScrollViewer_PreviewMouseWheel"
                            SelectionChanged="CurrentOperationDetailedDataGrid_SelectionChanged"
                            Style="{StaticResource DetailedFileOpGridStyle}" />
                        <Border
                            Grid.Column="1"
                            BorderBrush="Gray"
                            BorderThickness="1,0,0,0" />
                        <Menu
                            x:Name="FileOpControlsMenu"
                            Grid.Column="1"
                            Margin="1,0,0,0"
                            Style="{StaticResource DetailedFileOpControlsStyle}" />
                    </Grid>
                </Grid>
            </Expander>
            <Grid Grid.Row="3" Margin="6,0">
                <Grid.Resources>
                    <Style BasedOn="{StaticResource StatusBarSeparatorStyle}" TargetType="Separator" />
                    <Style BasedOn="{StaticResource MarginedTextBlockStyle}" TargetType="TextBlock" />
                </Grid.Resources>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto" />
                    <ColumnDefinition />
                    <ColumnDefinition Width="Auto" />
                </Grid.ColumnDefinitions>
                <StackPanel Orientation="Horizontal" Style="{StaticResource ItemsCountContainerStyle}">
                    <StackPanel Orientation="Horizontal" Style="{StaticResource ItemsCountStackPanelStyle}">
                        <TextBlock x:Name="ItemsCountBlock" Style="{StaticResource ItemsCountStyle}" />
                        <TextBlock Text=" " />
                        <TextBlock Style="{StaticResource ItemsCountSuffixStyle}" />
                        <TextBlock
                            x:Name="UnfinishedBlock"
                            Style="{StaticResource UnfinishedTextblockStyle}"
                            Text=" *" />
                    </StackPanel>
                    <Separator Visibility="{Binding ElementName=SelectedItemsCountContainer, Path=Visibility}" />
                    <StackPanel
                        x:Name="SelectedItemsCountContainer"
                        Orientation="Horizontal"
                        Style="{StaticResource SelectedItemsCountContainerStyle}">
                        <TextBlock x:Name="SelectedItemsBlock" Style="{StaticResource SelectedItemsStyle}" />
                        <TextBlock Text=" " />
                        <TextBlock Style="{StaticResource SelectedItemsSuffixStyle}" />
                        <TextBlock
                            x:Name="TotalSizeBlock"
                            Margin="6,4,0,4"
                            Style="{StaticResource TotalSizeStyle}"
                            Text="{Binding ElementName=MainWin, Path=SelectedFilesTotalSize}" />
                    </StackPanel>
                </StackPanel>
                <StackPanel
                    Grid.Column="2"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Center"
                    DataContext="{Binding Source={x:Static Member=models:Data.RuntimeSettings}, Path=CurrentDevice}"
                    Orientation="Horizontal">
                    <StackPanel Orientation="Horizontal">
                        <controls:TransferIndicator Margin="0,1,0,0" Style="{StaticResource DiskUsageIconStyle}" />
                        <Separator Style="{StaticResource DiskUsageSeparatorStyle}" />
                    </StackPanel>
                    <views:DetailedBatteryControl x:Name="CurrentDeviceBatteryIcon" DataContext="{Binding Battery}" />
                    <StackPanel Orientation="Horizontal" Style="{StaticResource AndroidTextBlockStyle}">
                        <Separator Style="{StaticResource CurrentDeviceBatterySeparatorStyle}" />
                        <ui:FontIcon Style="{DynamicResource UnsupportedIconStyle}" />
                        <TextBlock Text="Android " />
                        <TextBlock Text="{Binding AndroidVersion}" />
                        <TextBlock Style="{StaticResource AndroidVersionRecoveryTextblockStyle}">
                            <Run Text=" (" />
                            <Run Text="{Binding Mode=OneWay, Source={x:Static Member=strings:Resources.S_RECOVERY_MODE}}" />
                            <Run Text=")" />
                        </TextBlock>
                    </StackPanel>
                    <Menu Margin="6,0,-3,0" Style="{StaticResource LogToggleStyle}" />
                </StackPanel>
            </Grid>
        </Grid>
        <ui:SplitView
            x:Name="DevicesSplitView"
            d:IsHidden="False"
            d:IsPaneOpen="True"
            Style="{StaticResource DevicesSplitViewStyle}">
            <ui:SplitView.Pane>
                <Border Style="{StaticResource DevicesListStyle}">
                    <ScrollViewer
                        x:Name="DeviceListScrollViewer"
                        Grid.Row="2"
                        HorizontalScrollBarVisibility="Disabled">
                        <Grid>
                            <Grid.Style>
                                <Style TargetType="Grid">
                                    <Setter Property="Margin" Value="6,6,22,6" />
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=DeviceListScrollViewer, Path=ScrollableHeight}" Value="0">
                                            <Setter Property="Margin" Value="6" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Grid.Style>
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <ui:SimpleStackPanel Spacing="6">
                                <Expander d:Visibility="Visible" Style="{StaticResource MdnsExpanderStyle}">
                                    <helpers:ExpanderHelper.HeaderBottomContent>
                                        <ui:ProgressBar Style="{StaticResource MdnsProgressBarStyle}" />
                                    </helpers:ExpanderHelper.HeaderBottomContent>
                                    <Expander.Header>
                                        <CheckBox Click="MdnsCheckBox_Click" Style="{StaticResource MdnsCheckBoxStyle}" />
                                    </Expander.Header>
                                    <Grid>
                                        <ui:SimpleStackPanel
                                            Margin="4"
                                            Spacing="6"
                                            Style="{StaticResource MdnsOffPanelStyle}">
                                            <TextBlock helpers:TextHelper.AltText="{Binding Source={x:Static Member=strings:Resources.S_MDNS_OFF}}" Loaded="EmptyNonRootTextBlock_Loaded" />
                                        </ui:SimpleStackPanel>
                                        <Border Style="{StaticResource QrBackgroundStyle}">
                                            <Image
                                                x:Name="PairingQrImage"
                                                Margin="6"
                                                RenderOptions.EdgeMode="Aliased"
                                                Source="{Binding Source={x:Static Member=models:Data.QrClass}, Path=Image}" />
                                        </Border>
                                        <StackPanel
                                            Margin="0,4"
                                            Orientation="Horizontal"
                                            Style="{StaticResource MdnsInProgressPanelStyle}">
                                            <ui:FontIcon Margin="0,0,6,0" Glyph="&#xE823;" />
                                            <TextBlock>
                                                <TextBlock.Text>
                                                    <MultiBinding Converter="{StaticResource StringFormatConverter}" ConverterParameter="{x:Static strings:Resources.S_AWAITING_RESPONSE}">
                                                        <Binding Path="TimePassedString" Source="{x:Static Member=models:Data.MdnsService}" />
                                                    </MultiBinding>
                                                </TextBlock.Text>
                                            </TextBlock>
                                        </StackPanel>
                                        <ui:SimpleStackPanel
                                            Margin="0,4"
                                            Spacing="6"
                                            Style="{StaticResource MdnsDownPanelStyle}">
                                            <ui:SimpleStackPanel
                                                HorizontalAlignment="Center"
                                                Orientation="Horizontal"
                                                Spacing="6">
                                                <ui:FontIcon Glyph="&#xE783;" />
                                                <TextBlock Text="{Binding Source={x:Static Member=strings:Resources.S_SERVER_DOWN}}" />
                                            </ui:SimpleStackPanel>
                                            <Button
                                                HorizontalAlignment="Center"
                                                Click="RestartAdbButton_Click"
                                                Content="{Binding Source={x:Static Member=strings:Resources.S_RESTART_ADB}}" />
                                        </ui:SimpleStackPanel>
                                    </Grid>
                                </Expander>
                                <Grid>
                                    <Grid Margin="6,4,0,0" HorizontalAlignment="Left">
                                        <ui:ProgressRing IsActive="True" Style="{StaticResource DevicesPollingProgressRingStyle}" />
                                        <Button
                                            Click="RefreshDevicesButton_Click"
                                            Style="{StaticResource DevicesManualPollingButtonStyle}"
                                            ToolTip="{Binding Source={x:Static Member=strings:Resources.S_REFRESH_DEVICES}}">
                                            <ui:FontIcon FontSize="15" Glyph="&#xE72C;" />
                                        </Button>
                                    </Grid>
                                    <TextBlock
                                        HorizontalAlignment="Center"
                                        FontSize="24"
                                        Text="{Binding Source={x:Static Member=strings:Resources.S_BUTTON_DEVICES}}" />
                                </Grid>
                                <Border Padding="4" Style="{StaticResource UnresponsiveServerBorderStyle}">
                                    <StackPanel Margin="2,0">
                                        <ui:SimpleStackPanel Orientation="Horizontal" Spacing="8">
                                            <ui:FontIcon FontSize="24" Glyph="&#xEBE8;" />
                                            <StackPanel>
                                                <TextBlock Text="{Binding Source={x:Static Member=strings:Resources.S_SERVER_UNRESPONSIVE}}" />
                                                <StackPanel
                                                    Margin="0,4"
                                                    Orientation="Horizontal"
                                                    ToolTip="{Binding Source={x:Static Member=strings:Resources.S_TOOLTIP_UNRESPONSIVE}}">
                                                    <ui:FontIcon Margin="0,0,4,0" Glyph="&#xE823;" />
                                                    <TextBlock>
                                                        <TextBlock.Text>
                                                            <MultiBinding Converter="{StaticResource StringFormatConverter}" ConverterParameter="{x:Static strings:Resources.S_SECONDS_SHORT}">
                                                                <Binding Path="TimeFromLastResponse" Source="{x:Static Member=models:Data.RuntimeSettings}" />
                                                            </MultiBinding>
                                                        </TextBlock.Text>
                                                    </TextBlock>
                                                </StackPanel>
                                            </StackPanel>
                                        </ui:SimpleStackPanel>
                                        <ui:SimpleStackPanel
                                            Margin="0,4"
                                            HorizontalAlignment="Center"
                                            Orientation="Horizontal"
                                            Spacing="10">
                                            <Button
                                                Click="RestartAdbButton_Click"
                                                Content="{Binding Source={x:Static Member=strings:Resources.S_KILL_SERVER}}"
                                                Style="{StaticResource AccentButtonStyle}">
                                                <Button.ToolTip>
                                                    <TextBlock FontFamily="{StaticResource ConsoleFont}" Text="adb kill-server" />
                                                </Button.ToolTip>
                                            </Button>
                                            <Button
                                                Click="KillAdbButton_Click"
                                                Content="{Binding Source={x:Static Member=strings:Resources.S_KILL_PROCESS}}"
                                                Style="{StaticResource AccentButtonStyle}">
                                                <Button.ToolTip>
                                                    <TextBlock FontFamily="{StaticResource ConsoleFont}" Text="taskkill /f /im &quot;adb.exe&quot;" />
                                                </Button.ToolTip>
                                            </Button>
                                        </ui:SimpleStackPanel>
                                    </StackPanel>
                                </Border>
                            </ui:SimpleStackPanel>
                            <Grid Grid.Row="1" Margin="0,6,0,0">
                                <Grid.RowDefinitions>
                                    <RowDefinition Height="Auto" />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <ListView
                                    x:Name="DevicesList"
                                    ItemsSource="{Binding Source={x:Static Member=models:Data.DevicesObject}, Path=UIList}"
                                    Style="{StaticResource DevicesListViewStyle}" />
                                <Border
                                    Grid.Row="1"
                                    Background="Transparent"
                                    MouseDown="Border_MouseDown" />
                            </Grid>
                        </Grid>
                    </ScrollViewer>
                </Border>
            </ui:SplitView.Pane>
        </ui:SplitView>
        <ui:SplitView
            x:Name="SettingsSplitView"
            d:IsHidden="True"
            FocusVisualStyle="{x:Null}"
            IsPaneOpen="{Binding Source={x:Static Member=models:Data.RuntimeSettings}, Path=IsSettingsPaneOpen, Mode=TwoWay}"
            OpenPaneLength="350"
            PanePlacement="Right">
            <ui:SplitView.Resources>
                <Style
                    x:Key="CategorySeparator"
                    BasedOn="{StaticResource SeparatorStyle}"
                    TargetType="Separator">
                    <Setter Property="Width" Value="300" />
                    <Setter Property="HorizontalAlignment" Value="Center" />
                </Style>
                <Style BasedOn="{StaticResource CategorySeparator}" TargetType="Separator" />
                <Style BasedOn="{StaticResource CheckBoxStyle}" TargetType="CheckBox">
                    <Setter Property="HorizontalAlignment" Value="Stretch" />
                </Style>
                <Style BasedOn="{StaticResource RadioButtonStyle}" TargetType="RadioButton">
                    <Setter Property="HorizontalAlignment" Value="Stretch" />
                </Style>
                <Style BasedOn="{StaticResource FluentExpanderStyle}" TargetType="Expander">
                    <Setter Property="helpers:ExpanderHelper.ExpanderArrow" Value="CCW" />
                </Style>
                <Style BasedOn="{StaticResource SettingsComboboxStyle}" TargetType="ComboBox" />
            </ui:SplitView.Resources>
            <ui:SplitView.Pane>
                <Border
                    BorderBrush="Gray"
                    BorderThickness="1,1,0,0"
                    Style="{StaticResource SplitViewBorderStyle}">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="52" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <Menu Margin="10" Style="{StaticResource ResetAppSettingsMenuStyle}" />
                        <TextBlock
                            Margin="0,0,0,2"
                            HorizontalAlignment="Center"
                            VerticalAlignment="Center"
                            FontSize="24"
                            Text="{x:Static strings:Resources.S_SETTINGS_TITLE}" />
                        <Menu HorizontalAlignment="Right" Style="{StaticResource SettingsPaneMenuStyle}" />
                        <Grid
                            Grid.Row="1"
                            Grid.ColumnSpan="3"
                            Margin="18,0,0,0">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition />
                            </Grid.RowDefinitions>
                            <Grid Margin="6,0,24,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto" />
                                    <ColumnDefinition />
                                </Grid.ColumnDefinitions>
                                <Grid.RowDefinitions>
                                    <RowDefinition />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <Menu x:Name="SettingsControlsMenu" Style="{StaticResource SettingsControlsMenuStyle}" />
                                <Grid Grid.Column="1" Margin="3,0,0,0">
                                    <Grid.Style>
                                        <Style TargetType="Grid">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding Source={x:Static Member=models:Data.RuntimeSettings}, Path=SortedView}" Value="False">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </Grid.Style>
                                    <TextBox
                                        x:Name="SettingsSearchBox"
                                        Height="31"
                                        MinHeight="31"
                                        Padding="30,5,6,6"
                                        ui:ControlHelper.PlaceholderText="{x:Static strings:Resources.S_SEARCH_SETTINGS}"
                                        GotFocus="SettingsSearchBox_FocusChanged"
                                        LostFocus="SettingsSearchBox_FocusChanged"
                                        Text="{Binding Source={x:Static Member=models:Data.RuntimeSettings}, Path=SearchText, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                    <ui:FontIcon
                                        Margin="6,0,0,0"
                                        HorizontalAlignment="Left"
                                        Glyph="&#xE721;"
                                        IsHitTestVisible="False"
                                        Opacity="0.7" />
                                </Grid>
                                <Grid
                                    Grid.Row="1"
                                    Grid.ColumnSpan="2"
                                    Margin="0,8,0,4"
                                    Style="{StaticResource SettingsTitleSeparatorStyle}">
                                    <Separator Style="{x:Null}" />
                                </Grid>
                            </Grid>
                            <ScrollViewer Grid.Row="1">
                                <ui:SimpleStackPanel
                                    Margin="6,0,24,10"
                                    HorizontalAlignment="Left"
                                    Spacing="6">
                                    <Border
                                        Margin="0,6,0,0"
                                        BorderBrush="Gray"
                                        BorderThickness="1"
                                        Style="{StaticResource NotificationsBorderStyle}">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition />
                                                <RowDefinition />
                                            </Grid.RowDefinitions>
                                            <TextBlock
                                                Margin="4"
                                                HorizontalAlignment="Center"
                                                FontSize="16"
                                                Text="{x:Static strings:Resources.S_NOTIFICATIONS_TITLE}" />
                                            <ListView
                                                x:Name="NotificationsList"
                                                Grid.Row="1"
                                                Margin="24,0,24,6"
                                                Style="{StaticResource NotificationsListView}" />
                                        </Grid>
                                    </Border>
                                    <ListView
                                        x:Name="SettingsList"
                                        Margin="0,0,0,-3"
                                        Style="{StaticResource GroupSettingsListView}" />
                                    <ListView
                                        x:Name="SortedSettings"
                                        Margin="0,2,0,-3"
                                        MouseMove="SortedSettings_MouseMove"
                                        Style="{StaticResource SortedSettingsListView}" />
                                    <Separator />
                                    <Expander x:Name="SettingsAboutExpander" Style="{StaticResource SettingsAboutExpanderStyle}">
                                        <StackPanel>
                                            <TextBlock
                                                HorizontalAlignment="Center"
                                                FontFamily="{StaticResource Nunito}"
                                                FontSize="18"
                                                Text="{x:Static app_prop:AppGlobal.AppDisplayName}" />
                                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                                <TextBlock VerticalAlignment="Bottom" Text="v" />
                                                <TextBlock
                                                    VerticalAlignment="Bottom"
                                                    NumberSubstitution.Substitution="European"
                                                    Text="{x:Static app_prop:AppGlobal.AppVersion}" />
                                            </StackPanel>
                                            <Button
                                                Margin="0,10,0,0"
                                                HorizontalAlignment="Stretch"
                                                Click="SponsorButton_Click"
                                                ToolTip="{Binding Source={x:Static Member=resources:Links.SPONSOR}}">
                                                <ui:SimpleStackPanel Orientation="Horizontal" Spacing="6">
                                                    <ui:FontIcon Foreground="{DynamicResource SponsorIconBrush}" Glyph="&#xEB51;" />
                                                    <TextBlock Text="{x:Static strings:Resources.S_DONATE}" />
                                                </ui:SimpleStackPanel>
                                            </Button>
                                            <ui:SimpleStackPanel Margin="0,6" Spacing="-3">
                                                <ui:HyperlinkButton
                                                    Click="AppDataHyperlink_Click"
                                                    Content="{x:Static strings:Resources.S_APP_DATA_FOLDER}"
                                                    ToolTip="{Binding Source={x:Static Member=models:Data.AppDataPath}}" />
                                                <ui:HyperlinkButton
                                                    Content="{x:Static strings:Resources.S_GITHUB_REPO}"
                                                    NavigateUri="{Binding Source={x:Static Member=resources:Links.ADB_EXPLORER_GITHUB}}"
                                                    ToolTip="{Binding Source={x:Static Member=resources:Links.ADB_EXPLORER_GITHUB}}" />
                                                <ui:HyperlinkButton
                                                    Content="Weblate"
                                                    NavigateUri="{Binding Source={x:Static Member=resources:Links.WEBLATE}}"
                                                    ToolTip="{Binding Source={x:Static Member=resources:Links.WEBLATE}}" />
                                                <ui:HyperlinkButton
                                                    Content="{x:Static strings:Resources.S_PRIVACY_POLICY}"
                                                    NavigateUri="{Binding Source={x:Static Member=resources:Links.ADB_EXPLORER_PRIVACY}}"
                                                    ToolTip="{Binding Source={x:Static Member=resources:Links.ADB_EXPLORER_PRIVACY}}" />
                                            </ui:SimpleStackPanel>
                                            <CheckBox Style="{StaticResource UpdatesCheckBoxStyle}" />
                                            <TextBlock
                                                Margin="0,20,0,0"
                                                HorizontalAlignment="Center"
                                                FontWeight="Bold"
                                                Text="{x:Static strings:Resources.S_ATTRIBUTIONS}" />
                                            <ui:SimpleStackPanel Spacing="-3">
                                                <ui:HyperlinkButton
                                                    Content="ModernWPF"
                                                    NavigateUri="{Binding Source={x:Static Member=resources:Links.MODERN_WPF}}"
                                                    ToolTip="{Binding Source={x:Static Member=resources:Links.MODERN_WPF}}" />
                                                <ui:HyperlinkButton
                                                    Content="Icons8"
                                                    NavigateUri="{Binding Source={x:Static Member=resources:Links.ICONS8}}"
                                                    ToolTip="{Binding Source={x:Static Member=resources:Links.ICONS8}}" />
                                                <ui:HyperlinkButton
                                                    Content="LGPL v3"
                                                    NavigateUri="{Binding Source={x:Static Member=resources:Links.LGPL3}}"
                                                    ToolTip="{Binding Source={x:Static Member=resources:Links.LGPL3}}" />
                                                <ui:HyperlinkButton
                                                    Content="Apache"
                                                    NavigateUri="{Binding Source={x:Static Member=resources:Links.L_APACHE_LIC}}"
                                                    ToolTip="{Binding Source={x:Static Member=resources:Links.L_APACHE_LIC}}" />
                                                <ui:HyperlinkButton
                                                    Click="AndroidRobotLicense_Click"
                                                    Content="{x:Static strings:Resources.S_ANDROID_ICONS_TITLE}"
                                                    ToolTip="{x:Static strings:Resources.S_SEE_TERMS}" />
                                            </ui:SimpleStackPanel>
                                        </StackPanel>
                                    </Expander>
                                </ui:SimpleStackPanel>
                            </ScrollViewer>
                        </Grid>
                    </Grid>
                </Border>
            </ui:SplitView.Pane>
        </ui:SplitView>
        <controls:SplashScreen d:Visibility="Collapsed" />
    </Grid>
</Window>
