<Window
    x:Class="ADB_Explorer.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:helpers="clr-namespace:ADB_Explorer.Helpers"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:ADB_Explorer.Models"
    xmlns:services="clr-namespace:ADB_Explorer.Services"
    xmlns:sys="clr-namespace:System;assembly=System.Runtime"
    xmlns:ui="http://schemas.modernwpf.com/2019"
    Title="ADB Explorer"
    Width="800"
    Height="450"
    MinWidth="490"
    MinHeight="400"
    ui:ThemeManager.IsThemeAware="True"
    ui:WindowHelper.UseModernWindowStyle="True"
    Background="{DynamicResource SystemControlPageBackgroundChromeMediumLowBrush}"
    Closing="Window_Closing"
    KeyDown="Window_KeyDown"
    MouseDown="Window_MouseDown"
    MouseUp="Window_MouseUp"
    SizeChanged="Window_SizeChanged"
    WindowStartupLocation="CenterScreen"
    mc:Ignorable="d">
    <Window.Resources>
        <sys:Int16 x:Key="FontSize">13</sys:Int16>
        <ContextMenu x:Key="RowContextMenu">
            <ContextMenu.Resources>
                <Style TargetType="MenuItem">
                    <Setter Property="Height" Value="24" />
                    <Setter Property="Padding" Value="6,0" />
                </Style>
                <Style TargetType="ui:FontIcon">
                    <Setter Property="Margin" Value="0,0,6,0" />
                    <Setter Property="FontSize" Value="16" />
                </Style>
                <Style TargetType="StackPanel">
                    <Setter Property="Orientation" Value="Horizontal" />
                </Style>
            </ContextMenu.Resources>
        </ContextMenu>
        <MenuItem x:Key="ContextMenuCopyItem" Click="ContextMenuCopyItem_Click">
            <MenuItem.Resources>
                <Style TargetType="ui:FontIcon">
                    <Setter Property="FontSize" Value="16" />
                    <Style.Triggers>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Foreground" Value="Gray" />
                        </Trigger>
                    </Style.Triggers>
                </Style>
                <Style TargetType="TextBlock">
                    <Style.Triggers>
                        <Trigger Property="IsEnabled" Value="False">
                            <Setter Property="Foreground" Value="Gray" />
                        </Trigger>
                    </Style.Triggers>
                    <Setter Property="Margin" Value="6,0,0,0" />
                </Style>
            </MenuItem.Resources>
            <MenuItem.Header>
                <StackPanel>
                    <ui:FontIcon Glyph="&#xE8C8;" />
                    <TextBlock Text="Copy" />
                </StackPanel>
            </MenuItem.Header>
        </MenuItem>
        <MenuItem x:Key="ContextMenuDeleteItem">
            <MenuItem.Header>
                <StackPanel>
                    <ui:FontIcon Glyph="&#xE74D;" />
                    <TextBlock Text="Delete" />
                </StackPanel>
            </MenuItem.Header>
        </MenuItem>
        <Style x:Key="CellVerticalStyle" TargetType="{x:Type DataGridCell}">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type DataGridCell}">
                        <Grid Margin="0" Background="{TemplateBinding Background}">
                            <ContentPresenter VerticalAlignment="Center" />
                        </Grid>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Foreground" Value="{DynamicResource SystemControlPageTextBaseHighBrush}" />
            <Setter Property="FocusVisualStyle" Value="{x:Null}" />
        </Style>
        <Style x:Key="TextBlockLightStyle" TargetType="TextBlock">
            <Setter Property="Background" Value="White" />
        </Style>
        <Style x:Key="TextBlockDarkStyle" TargetType="TextBlock">
            <Setter Property="Background" Value="#FF202020" />
        </Style>
        <Style x:Key="RowStyle" TargetType="DataGridRow">
            <EventSetter Event="MouseDown" Handler="DataGridRow_MouseDown" />
            <EventSetter Event="MouseDoubleClick" Handler="DataGridRow_MouseDoubleClick" />
            <EventSetter Event="KeyDown" Handler="DataGridRow_KeyDown" />
            <Setter Property="ContextMenu" Value="{StaticResource RowContextMenu}" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="DataGridRow">
                        <Border
                            x:Name="RowBorder"
                            HorizontalAlignment="Left"
                            Background="{TemplateBinding Background}"
                            BorderBrush="{TemplateBinding BorderBrush}"
                            BorderThickness="{TemplateBinding BorderThickness}"
                            SnapsToDevicePixels="True">
                            <DataGridCellsPresenter ItemsPanel="{TemplateBinding ItemsPanel}" SnapsToDevicePixels="{TemplateBinding SnapsToDevicePixels}" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style
            x:Key="RowLightStyle"
            BasedOn="{StaticResource RowStyle}"
            TargetType="DataGridRow">
            <Setter Property="Background" Value="White" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFE5F3FF" />
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#FFCCE8FF" />
                </Trigger>
                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=IsSelected}" Value="True" />
                        <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=Window, Mode=FindAncestor}, Path=IsActive}" Value="False" />
                    </MultiDataTrigger.Conditions>
                    <Setter Property="Background" Value="#FFD9D9D9" />
                </MultiDataTrigger>
                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=IsMouseOver}" Value="True" />
                        <Condition Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=IsSelected}" Value="True" />
                        <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=Window, Mode=FindAncestor}, Path=IsActive}" Value="False" />
                    </MultiDataTrigger.Conditions>
                    <Setter Property="Background" Value="#FFCCE8FF" />
                </MultiDataTrigger>
            </Style.Triggers>
        </Style>
        <Style
            x:Key="RowDarkStyle"
            BasedOn="{StaticResource RowStyle}"
            TargetType="DataGridRow">
            <Setter Property="Background" Value="#FF202020" />
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF4D4D4D" />
                </Trigger>
                <Trigger Property="IsSelected" Value="True">
                    <Setter Property="Background" Value="#FF777777" />
                </Trigger>
                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=IsSelected}" Value="True" />
                        <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=Window, Mode=FindAncestor}, Path=IsActive}" Value="False" />
                    </MultiDataTrigger.Conditions>
                    <Setter Property="Background" Value="#FF333333" />
                </MultiDataTrigger>
                <MultiDataTrigger>
                    <MultiDataTrigger.Conditions>
                        <Condition Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=IsMouseOver}" Value="True" />
                        <Condition Binding="{Binding RelativeSource={RelativeSource Mode=Self}, Path=IsSelected}" Value="True" />
                        <Condition Binding="{Binding RelativeSource={RelativeSource AncestorType=Window, Mode=FindAncestor}, Path=IsActive}" Value="False" />
                    </MultiDataTrigger.Conditions>
                    <Setter Property="Background" Value="#FF777777" />
                </MultiDataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="DriveInfoTemplate" TargetType="ui:ListViewItem">
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ui:ListViewItem">
                        <StackPanel>
                            <StackPanel HorizontalAlignment="Center" Orientation="Horizontal">
                                <TextBlock Text="{Binding PrettyName}" />
                                <TextBlock Text=": " />
                                <TextBlock Text="{Binding Used, Mode=OneWay}" />
                                <TextBlock Text=" / " />
                                <TextBlock Text="{Binding Size, Mode=OneWay}" />
                            </StackPanel>
                            <ui:ProgressBar Margin="8,4,8,0" Value="{Binding UsageP, Mode=OneWay}" />
                        </StackPanel>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style x:Key="DeviceStyle" TargetType="ui:ListViewItem">
            <EventSetter Event="PreviewMouseDown" Handler="ListViewItem_MouseDown" />
            <Setter Property="HorizontalContentAlignment" Value="Stretch" />
            <Setter Property="Margin" Value="0,1" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ui:ListViewItem">
                        <Border Background="{TemplateBinding Background}" CornerRadius="4">
                            <Grid>
                                <Grid.RowDefinitions>
                                    <RowDefinition />
                                    <RowDefinition />
                                </Grid.RowDefinitions>
                                <StackPanel x:Name="DeviceDetailsPanel" Orientation="Horizontal">
                                    <ui:FontIcon
                                        Margin="4"
                                        FontSize="28"
                                        Glyph="{Binding Icon}" />
                                    <TextBlock
                                        Margin="4"
                                        VerticalAlignment="Center"
                                        Text="{Binding Name}">
                                        <TextBlock.Style>
                                            <Style TargetType="TextBlock">
                                                <Style.Triggers>
                                                    <DataTrigger Binding="{Binding IsOpen}" Value="True">
                                                        <Setter Property="FontWeight" Value="Bold" />
                                                    </DataTrigger>
                                                </Style.Triggers>
                                            </Style>
                                        </TextBlock.Style>
                                    </TextBlock>
                                </StackPanel>
                                <ui:FontIcon
                                    Margin="4"
                                    HorizontalAlignment="Right"
                                    Foreground="Gray"
                                    Glyph="&#xE838;">
                                    <ui:FontIcon.Style>
                                        <Style TargetType="ui:FontIcon">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsOpen}" Value="False">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </ui:FontIcon.Style>
                                </ui:FontIcon>
                                <StackPanel Grid.Row="1">
                                    <StackPanel.Style>
                                        <Style TargetType="StackPanel">
                                            <Style.Triggers>
                                                <DataTrigger Binding="{Binding IsSelected}" Value="False">
                                                    <Setter Property="Visibility" Value="Collapsed" />
                                                </DataTrigger>
                                            </Style.Triggers>
                                        </Style>
                                    </StackPanel.Style>
                                    <StackPanel
                                        Margin="4"
                                        HorizontalAlignment="Right"
                                        Orientation="Horizontal">
                                        <Grid Margin="8,0">
                                            <Grid.Style>
                                                <Style TargetType="Grid">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding IsOpen}" Value="True">
                                                            <Setter Property="IsEnabled" Value="False" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Type}" Value="2">
                                                            <Setter Property="IsEnabled" Value="False" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Type}" Value="3">
                                                            <Setter Property="IsEnabled" Value="False" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Grid.Style>
                                            <Button
                                                x:Name="OpenDeviceButton"
                                                Click="OpenDeviceButton_Click"
                                                Content="Browse" />
                                        </Grid>
                                        <Grid>
                                            <Grid.Style>
                                                <Style TargetType="Grid">
                                                    <Style.Triggers>
                                                        <DataTrigger Binding="{Binding Type}" Value="0">
                                                            <Setter Property="IsEnabled" Value="False" />
                                                        </DataTrigger>
                                                        <DataTrigger Binding="{Binding Type}" Value="3">
                                                            <Setter Property="IsEnabled" Value="False" />
                                                        </DataTrigger>
                                                    </Style.Triggers>
                                                </Style>
                                            </Grid.Style>
                                            <Button
                                                x:Name="DisconnectDeviceButton"
                                                Click="DisconnectDeviceButton_Click"
                                                Content="Remove" />
                                        </Grid>
                                    </StackPanel>
                                </StackPanel>
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
        <Style
            x:Key="DeviceLightStyle"
            BasedOn="{StaticResource DeviceStyle}"
            TargetType="ui:ListViewItem">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                    <Setter Property="Background" Value="#FFD9D9D9" />
                </DataTrigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FFC9C9C9" />
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style
            x:Key="DeviceDarkStyle"
            BasedOn="{StaticResource DeviceStyle}"
            TargetType="ui:ListViewItem">
            <Style.Triggers>
                <DataTrigger Binding="{Binding IsSelected}" Value="True">
                    <Setter Property="Background" Value="#FF333333" />
                </DataTrigger>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="Background" Value="#FF4D4D4D" />
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="ProgressBarStyle" TargetType="ui:ProgressBar">
            <Style.Triggers>
                <DataTrigger Binding="{Binding StatusInfo.TotalPercentage}" Value="{x:Null}">
                    <Setter Property="IsIndeterminate" Value="True" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Completed">
                    <Setter Property="Visibility" Value="Collapsed" />
                </DataTrigger>
                <DataTrigger Binding="{Binding Status}" Value="Failed">
                    <Setter Property="Visibility" Value="Collapsed" />
                </DataTrigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="FileOpItemStyle" TargetType="ui:ListViewItem">
            <Setter Property="Background" Value="Transparent" />
            <Setter Property="Margin" Value="4,0,4,2" />
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ui:ListViewItem">
                        <Border Background="#7D7D7D7D" CornerRadius="4">
                            <Grid Width="240" Margin="2,0,0,0">
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition />
                                    <ColumnDefinition Width="Auto" />
                                </Grid.ColumnDefinitions>
                                <StackPanel>
                                    <StackPanel Orientation="Horizontal">
                                        <TextBlock Text="Pull: " />
                                        <TextBlock Text="{Binding Status}" />
                                        <TextBlock Margin="4,0,0,0" Text="{Binding StatusInfo.TotalPercentage}" />
                                    </StackPanel>
                                    <Grid MaxWidth="200" HorizontalAlignment="Left">
                                        <TextBlock HorizontalAlignment="Right" Text="{Binding FilePath}" />
                                    </Grid>
                                    <ui:ProgressBar
                                        Margin="0,2,10,2"
                                        Style="{StaticResource ProgressBarStyle}"
                                        Value="{Binding StatusInfo.TotalPercentage}" />
                                </StackPanel>
                                <Button
                                    Grid.Column="1"
                                    HorizontalAlignment="Right"
                                    VerticalAlignment="Center"
                                    Click="CloseOperationButton_Click"
                                    Content="&#xE8BB;"
                                    FontFamily="Segoe MDL2 Assets"
                                    FontSize="10" />
                            </Grid>
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </Window.Resources>
    <Grid>
        <Grid>
            <Grid.RowDefinitions>
                <RowDefinition Height="50" />
                <RowDefinition Height="54" />
                <RowDefinition />
                <RowDefinition Height="Auto" />
            </Grid.RowDefinitions>
            <Menu Margin="7,0" VerticalAlignment="Center">
                <Menu.Resources>
                    <Style TargetType="ui:FontIcon">
                        <Setter Property="FontSize" Value="18" />
                        <Style.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="Gray" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                    <Style TargetType="TextBlock">
                        <Style.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="Gray" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Menu.Resources>
                <MenuItem
                    x:Name="OpenDevicesButton"
                    Click="OpenDevicesButton_Click"
                    ToolTip="Devices">
                    <MenuItem.Header>
                        <Grid>
                            <ui:FontIcon Glyph="&#xE8CC;" />
                            <TextBlock
                                Margin="0,0,-10,-12"
                                HorizontalAlignment="Right"
                                VerticalAlignment="Bottom"
                                Text="{Binding ElementName=DevicesList, Path=Items.Count}" />
                        </Grid>
                    </MenuItem.Header>
                </MenuItem>
                <Separator Margin="4,0" Style="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" />
                <MenuItem
                    x:Name="NewMenuButton"
                    Margin="2,0"
                    IsEnabled="False">
                    <MenuItem.Header>
                        <StackPanel Orientation="Horizontal">
                            <ui:FontIcon
                                Margin="0,0,8,0"
                                FontSize="20"
                                Glyph="&#xECC8;" />
                            <TextBlock VerticalAlignment="Center" Text="New" />
                        </StackPanel>
                    </MenuItem.Header>
                    <MenuItem>
                        <MenuItem.Header>
                            <StackPanel Orientation="Horizontal">
                                <ui:FontIcon
                                    Margin="0,0,8,0"
                                    FontSize="16"
                                    Glyph="&#xECC8;" />
                                <TextBlock Text="New Item" />
                            </StackPanel>
                        </MenuItem.Header>
                    </MenuItem>
                    <MenuItem>
                        <MenuItem.Header>
                            New Folder
                        </MenuItem.Header>
                    </MenuItem>
                </MenuItem>
                <MenuItem IsEnabled="False" ToolTip="Cut">
                    <MenuItem.Header>
                        <ui:FontIcon Glyph="&#xE8C6;" />
                    </MenuItem.Header>
                </MenuItem>
                <MenuItem
                    x:Name="CopyMenuButton"
                    Click="CopyMenuButton_Click"
                    IsEnabled="False"
                    ToolTip="Copy">
                    <MenuItem.Header>
                        <ui:FontIcon Glyph="&#xE8C8;" />
                    </MenuItem.Header>
                </MenuItem>
                <MenuItem IsEnabled="False" ToolTip="Paste">
                    <MenuItem.Header>
                        <ui:FontIcon Glyph="&#xE77F;" />
                    </MenuItem.Header>
                </MenuItem>
                <MenuItem IsEnabled="False" ToolTip="Rename">
                    <MenuItem.Header>
                        <ui:FontIcon Glyph="&#xE8AC;" />
                    </MenuItem.Header>
                </MenuItem>
                <MenuItem IsEnabled="False" ToolTip="Share">
                    <MenuItem.Header>
                        <ui:FontIcon Glyph="&#xE72D;" />
                    </MenuItem.Header>
                </MenuItem>
                <MenuItem IsEnabled="False" ToolTip="Delete">
                    <MenuItem.Header>
                        <ui:FontIcon Glyph="&#xE74D;" />
                    </MenuItem.Header>
                </MenuItem>
            </Menu>
            <Menu Margin="0,0,7,0" HorizontalAlignment="Right">
                <Menu.Resources>
                    <Style TargetType="ui:FontIcon">
                        <Setter Property="FontSize" Value="18" />
                        <Style.Triggers>
                            <Trigger Property="IsEnabled" Value="False">
                                <Setter Property="Foreground" Value="Gray" />
                            </Trigger>
                        </Style.Triggers>
                    </Style>
                </Menu.Resources>
                <MenuItem
                    x:Name="FileOperationsButton"
                    Click="FileOperationsButton_Click"
                    IsEnabled="{Binding ElementName=FileOperationsList, Path=Items.Count}"
                    ToolTip="File Operations">
                    <MenuItem.Header>
                        <ui:FontIcon Glyph="&#xF16A;" />
                    </MenuItem.Header>
                </MenuItem>
                <MenuItem
                    x:Name="SettingsButton"
                    Click="SettingsButton_Click"
                    ToolTip="Settings">
                    <MenuItem.Header>
                        <ui:FontIcon Glyph="&#xE713;" />
                    </MenuItem.Header>
                </MenuItem>
            </Menu>
            <StackPanel Grid.Row="1">
                <Separator />
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto" />
                        <ColumnDefinition />
                    </Grid.ColumnDefinitions>
                    <Menu Margin="7,0,0,0">
                        <Menu.Resources>
                            <Style TargetType="ui:FontIcon">
                                <Setter Property="FontSize" Value="14" />
                                <Style.Triggers>
                                    <Trigger Property="IsEnabled" Value="False">
                                        <Setter Property="Foreground" Value="Gray" />
                                    </Trigger>
                                </Style.Triggers>
                            </Style>
                        </Menu.Resources>
                        <MenuItem
                            x:Name="HomeButton"
                            Click="HomeButton_Click"
                            IsEnabled="False"
                            ToolTip="Device Drives">
                            <MenuItem.Header>
                                <ui:FontIcon FontSize="16" Glyph="&#xE80F;" />
                            </MenuItem.Header>
                        </MenuItem>
                        <MenuItem
                            x:Name="BackButton"
                            Click="BackButton_Click"
                            IsEnabled="False"
                            ToolTip="Back">
                            <MenuItem.Header>
                                <ui:FontIcon Glyph="&#xE72B;" />
                            </MenuItem.Header>
                        </MenuItem>
                        <MenuItem
                            x:Name="ForwardButton"
                            Click="ForwardButton_Click"
                            IsEnabled="False"
                            ToolTip="Forward">
                            <MenuItem.Header>
                                <ui:FontIcon Glyph="&#xE72A;" />
                            </MenuItem.Header>
                        </MenuItem>
                        <MenuItem
                            x:Name="ParentButton"
                            Click="ParentButton_Click"
                            IsEnabled="False"
                            ToolTip="Up">
                            <MenuItem.Header>
                                <ui:FontIcon Glyph="&#xE197;" />
                            </MenuItem.Header>
                        </MenuItem>
                    </Menu>
                    <TextBox
                        x:Name="PathBox"
                        Grid.Column="1"
                        Margin="6"
                        Padding="36,0,0,0"
                        VerticalContentAlignment="Center"
                        GotFocus="PathBox_GotFocus"
                        IsEnabled="False"
                        IsReadOnly="True"
                        KeyDown="PathBox_KeyDown"
                        LostFocus="PathBox_LostFocus" />
                    <StackPanel
                        Grid.Column="1"
                        Margin="10"
                        Orientation="Horizontal">
                        <StackPanel.Resources>
                            <Style TargetType="TextBlock">
                                <Setter Property="VerticalAlignment" Value="Center" />
                            </Style>
                        </StackPanel.Resources>
                        <Border Background="DodgerBlue">
                            <Border.Style>
                                <Style TargetType="Border">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=PathStackPanel, Path=Visibility}" Value="Visible">
                                            <Setter Property="Visibility" Value="Collapsed" />
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Border.Style>
                            <TextBlock
                                x:Name="InputLangBlock"
                                Margin="5,0"
                                FontSize="15"
                                FontWeight="DemiBold"
                                MouseDown="InputLangBlock_MouseDown" />
                        </Border>
                        <StackPanel x:Name="PathStackPanel" Orientation="Horizontal" />
                    </StackPanel>
                </Grid>
            </StackPanel>
            <TextBlock
                x:Name="GridBackgroundBlock"
                Grid.Row="2"
                Style="{StaticResource TextBlockLightStyle}" />
            <ui:ItemsRepeater
                x:Name="DrivesItemRepeater"
                Grid.Row="2"
                Margin="10"
                ItemsSource="{Binding}">
                <ui:ItemsRepeater.Layout>
                    <ui:UniformGridLayout
                        MinColumnSpacing="10"
                        MinItemHeight="60"
                        MinItemWidth="280"
                        MinRowSpacing="10" />
                </ui:ItemsRepeater.Layout>
                <ui:ItemsRepeater.ItemTemplate>
                    <DataTemplate DataType="Drive">
                        <Border Background="LightGray">
                            <Menu Height="60">
                                <MenuItem Height="60" Click="DriveItem_Click">
                                    <MenuItem.Header>
                                        <Grid MinWidth="256">
                                            <Grid.ColumnDefinitions>
                                                <ColumnDefinition Width="Auto" />
                                                <ColumnDefinition />
                                            </Grid.ColumnDefinitions>
                                            <ui:FontIcon
                                                Margin="0,0,8,0"
                                                FontSize="32"
                                                Glyph="{Binding DriveIcon}" />
                                            <StackPanel Grid.Column="1">
                                                <StackPanel Orientation="Horizontal">
                                                    <StackPanel.Resources>
                                                        <Style TargetType="TextBlock">
                                                            <Setter Property="FontWeight" Value="SemiBold" />
                                                        </Style>
                                                    </StackPanel.Resources>
                                                    <TextBlock Text="{Binding PrettyName}" />
                                                    <StackPanel Orientation="Horizontal">
                                                        <StackPanel.Style>
                                                            <Style TargetType="StackPanel">
                                                                <Setter Property="Visibility" Value="Collapsed" />
                                                                <Style.Triggers>
                                                                    <DataTrigger Binding="{Binding Type}" Value="External">
                                                                        <Setter Property="Visibility" Value="Visible" />
                                                                    </DataTrigger>
                                                                </Style.Triggers>
                                                            </Style>
                                                        </StackPanel.Style>
                                                        <TextBlock Text=" (" />
                                                        <TextBlock
                                                            VerticalAlignment="Center"
                                                            FontFamily="Consolas"
                                                            Text="{Binding ID}" />
                                                        <TextBlock Text=")" />
                                                    </StackPanel>
                                                </StackPanel>
                                                <ui:ProgressBar Margin="0,6" Value="{Binding UsageP, Mode=OneWay}" />
                                                <StackPanel Orientation="Horizontal">
                                                    <TextBlock Text="{Binding Available, Mode=OneWay}" />
                                                    <TextBlock Text=" free of " />
                                                    <TextBlock Text="{Binding Size, Mode=OneWay}" />
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>
                                    </MenuItem.Header>
                                </MenuItem>
                            </Menu>
                        </Border>
                    </DataTemplate>
                </ui:ItemsRepeater.ItemTemplate>
            </ui:ItemsRepeater>
            <DataGrid
                x:Name="ExplorerGrid"
                Grid.Row="2"
                AutoGenerateColumns="False"
                Background="Transparent"
                CanUserResizeRows="False"
                CellStyle="{StaticResource CellVerticalStyle}"
                ContextMenu="{StaticResource RowContextMenu}"
                ContextMenuOpening="ExplorerGrid_ContextMenuOpening"
                GridLinesVisibility="None"
                HeadersVisibility="Column"
                IsReadOnly="True"
                ItemsSource="{Binding}"
                KeyboardNavigation.TabNavigation="Once"
                MinRowHeight="21"
                MouseDown="ExplorerGrid_MouseDown"
                PreviewMouseRightButtonDown="ExplorerGrid_PreviewMouseRightButtonDown"
                RowStyle="{StaticResource RowLightStyle}"
                SelectedItem="{Binding SelectedRow, Mode=TwoWay}"
                SelectionChanged="ExplorerGrid_SelectionChanged"
                SelectionMode="Extended"
                SelectionUnit="FullRow"
                Visibility="Collapsed">
                <DataGrid.Columns>
                    <DataGridTemplateColumn x:Name="Icon" CanUserResize="False">
                        <DataGridTemplateColumn.CellTemplate>
                            <DataTemplate>
                                <Image
                                    Width="16"
                                    RenderOptions.BitmapScalingMode="HighQuality"
                                    Source="{Binding Icon}" />
                            </DataTemplate>
                        </DataGridTemplateColumn.CellTemplate>
                    </DataGridTemplateColumn>
                    <DataGridTextColumn
                        x:Name="Name"
                        Binding="{Binding FileName}"
                        FontSize="{Binding Source={StaticResource FontSize}}"
                        Header="Name" />
                    <DataGridTextColumn
                        x:Name="Date"
                        FontSize="{Binding Source={StaticResource FontSize}}"
                        Header="Date modified"
                        SortMemberPath="ModifiedTime">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Margin" Value="4,0,8,0" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Type}" Value="File">
                                        <Setter Property="Text" Value="{Binding ModifiedTimeString}" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Type}" Value="Folder">
                                        <Setter Property="Text" Value="{Binding ModifiedTimeString}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn
                        x:Name="Type"
                        FontSize="{Binding Source={StaticResource FontSize}}"
                        Header="Type">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Margin" Value="4,0,0,0" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Type}" Value="File">
                                        <Setter Property="Text" Value="{Binding Type}" />
                                    </DataTrigger>
                                    <DataTrigger Binding="{Binding Type}" Value="Folder">
                                        <Setter Property="Text" Value="{Binding Type}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                    <DataGridTextColumn
                        x:Name="Size"
                        FontSize="{Binding Source={StaticResource FontSize}}"
                        Header="Size"
                        SortMemberPath="Size">
                        <DataGridTextColumn.ElementStyle>
                            <Style TargetType="TextBlock">
                                <Setter Property="Margin" Value="4,0,0,0" />
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding Type}" Value="File">
                                        <Setter Property="Text" Value="{Binding SizeString}" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </DataGridTextColumn.ElementStyle>
                    </DataGridTextColumn>
                </DataGrid.Columns>
            </DataGrid>
            <StackPanel Grid.Row="3" Orientation="Horizontal">
                <StackPanel.Resources>
                    <Style BasedOn="{StaticResource {x:Static ToolBar.SeparatorStyleKey}}" TargetType="Separator">
                        <Setter Property="Margin" Value="8,6,4,6" />
                    </Style>
                </StackPanel.Resources>
                <StackPanel Orientation="Horizontal">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ElementName=ItemsCountBlock, Path=Text}" Value="0">
                                    <Setter Property="Visibility" Value="Hidden" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock
                        x:Name="ItemsCountBlock"
                        Margin="8,4,0,4"
                        Text="{Binding ElementName=ExplorerGrid, Path=Items.Count}" />
                    <TextBlock Margin="0,4" Text=" item" />
                    <TextBlock Margin="0,4" Text="s">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ElementName=ItemsCountBlock, Path=Text}" Value="1">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <TextBlock
                        x:Name="UnfinishedBlock"
                        Margin="0,4"
                        Text=" *"
                        Visibility="Collapsed" />
                    <StackPanel Orientation="Horizontal">
                        <Separator />
                    </StackPanel>
                </StackPanel>
                <StackPanel Orientation="Horizontal">
                    <StackPanel.Style>
                        <Style TargetType="StackPanel">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding ElementName=SelectedItemsBlock, Path=Text}" Value="0">
                                    <Setter Property="Visibility" Value="Hidden" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </StackPanel.Style>
                    <TextBlock
                        x:Name="SelectedItemsBlock"
                        Margin="4,4,0,4"
                        Text="{Binding ElementName=ExplorerGrid, Path=SelectedItems.Count}" />
                    <TextBlock Margin="0,4" Text=" item" />
                    <TextBlock Margin="0,4" Text="s">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ElementName=SelectedItemsBlock, Path=Text}" Value="1">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <TextBlock Margin="0,4" Text=" selected" />
                    <TextBlock x:Name="TotalSizeBlock" Margin="6,4,0,4">
                        <TextBlock.Style>
                            <Style TargetType="TextBlock">
                                <Style.Triggers>
                                    <DataTrigger Binding="{Binding ElementName=TotalSizeBlock, Path=Text}" Value="0">
                                        <Setter Property="Visibility" Value="Collapsed" />
                                    </DataTrigger>
                                </Style.Triggers>
                            </Style>
                        </TextBlock.Style>
                    </TextBlock>
                    <StackPanel Orientation="Horizontal">
                        <Separator />
                    </StackPanel>
                </StackPanel>
            </StackPanel>
            <Grid Grid.Row="3" HorizontalAlignment="Right">
                <TextBlock
                    x:Name="OperationCompletedTextBlock"
                    Margin="6,0"
                    VerticalAlignment="Center" />
                <Grid x:Name="ProgressGrid" Visibility="Collapsed">
                    <ui:ProgressBar
                        x:Name="OverallProgressBar"
                        Width="200"
                        Margin="4"
                        VerticalAlignment="Stretch"
                        CornerRadius="0"
                        Maximum="100"
                        Minimum="0"
                        Value="50" />
                    <TextBlock
                        x:Name="ProgressCountTextBlock"
                        HorizontalAlignment="Center"
                        VerticalAlignment="Center"
                        Text="0/0" />
                </Grid>
            </Grid>
        </Grid>
        <ui:SplitView
            x:Name="FileOperationsSplitView"
            FocusVisualStyle="{x:Null}"
            OpenPaneLength="280"
            PanePlacement="Right">
            <ui:SplitView.Pane>
                <Border BorderBrush="Gray" BorderThickness="1,1,0,0">
                    <Grid Margin="0,8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="48" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            HorizontalAlignment="Center"
                            FontSize="24"
                            Text="File Operations" />
                        <Grid Grid.Row="1">
                            <Grid.RowDefinitions>
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                                <RowDefinition Height="Auto" />
                            </Grid.RowDefinitions>
                            <ScrollViewer>
                                <ui:ListView
                                    x:Name="CurrentOperationList"
                                    Margin="0,10"
                                    IsSelectionEnabled="False"
                                    ItemContainerStyle="{StaticResource FileOpItemStyle}"
                                    ItemsSource="{Binding}" />
                            </ScrollViewer>
                            <ScrollViewer Grid.Row="1">
                                <ui:ListView
                                    x:Name="PendingOperationsList"
                                    Margin="0,10"
                                    IsSelectionEnabled="False"
                                    ItemContainerStyle="{StaticResource FileOpItemStyle}"
                                    ItemsSource="{Binding}" />
                            </ScrollViewer>
                            <ScrollViewer Grid.Row="2">
                                <ui:ListView
                                    x:Name="CompletedOperationsList"
                                    Margin="0,10"
                                    IsSelectionEnabled="False"
                                    ItemContainerStyle="{StaticResource FileOpItemStyle}"
                                    ItemsSource="{Binding}" />
                            </ScrollViewer>
                        </Grid>
                    </Grid>
                </Border>
            </ui:SplitView.Pane>
        </ui:SplitView>
        <ui:SplitView
            x:Name="DevicesSplitView"
            FocusVisualStyle="{x:Null}"
            IsPaneOpen="True"
            OpenPaneLength="200"
            PaneClosing="DevicesSplitView_PaneClosing"
            PaneOpening="DevicesSplitView_PaneOpening"
            PanePlacement="Left">
            <ui:SplitView.Pane>
                <Border BorderBrush="Gray" BorderThickness="0,1,1,0">
                    <Grid Margin="6,8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="50" />
                            <RowDefinition Height="{Binding ElementName=NewDeviceRect, Path=ActualHeight}" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock
                            Margin="0,5"
                            HorizontalAlignment="Center"
                            FontSize="24"
                            Text="Devices" />
                        <Menu HorizontalAlignment="Right">
                            <MenuItem
                                x:Name="OpenNewDeviceButton"
                                Click="OpenNewDeviceButton_Click"
                                ToolTip="Add a device">
                                <MenuItem.Header>
                                    <ui:FontIcon FontSize="22" Glyph="&#xECC8;" />
                                </MenuItem.Header>
                            </MenuItem>
                        </Menu>
                        <Rectangle
                            x:Name="NewDeviceRect"
                            Grid.Row="1"
                            Height="{Binding ElementName=NewDevicePanel, Path=ActualHeight}"
                            Fill="Transparent">
                            <Rectangle.Style>
                                <Style TargetType="Rectangle">
                                    <Style.Triggers>
                                        <DataTrigger Binding="{Binding ElementName=NewDevicePanel, Path=Tag}" Value="Open">
                                            <DataTrigger.EnterActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation
                                                            Storyboard.TargetProperty="Height"
                                                            From="0"
                                                            Duration="0:00:00.2" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.EnterActions>
                                            <DataTrigger.ExitActions>
                                                <BeginStoryboard>
                                                    <Storyboard>
                                                        <DoubleAnimation
                                                            Storyboard.TargetProperty="Height"
                                                            To="0"
                                                            Duration="0:00:00.2" />
                                                    </Storyboard>
                                                </BeginStoryboard>
                                            </DataTrigger.ExitActions>
                                        </DataTrigger>
                                    </Style.Triggers>
                                </Style>
                            </Rectangle.Style>
                        </Rectangle>
                        <StackPanel
                            x:Name="NewDevicePanel"
                            Grid.Row="1"
                            VerticalAlignment="Bottom"
                            Visibility="Collapsed">
                            <StackPanel Margin="8">
                                <TextBlock Text="IP:" />
                                <TextBox
                                    x:Name="NewDeviceIpBox"
                                    FontFamily="Consolas"
                                    KeyDown="NewDeviceIpBox_KeyDown"
                                    TextChanged="NewDeviceIpBox_TextChanged" />
                                <TextBlock Margin="0,6,0,0" Text="Port:" />
                                <TextBox
                                    x:Name="NewDevicePortBox"
                                    FontFamily="Consolas"
                                    KeyDown="NewDeviceIpBox_KeyDown"
                                    TextChanged="NewDeviceIpBox_TextChanged" />
                                <TextBlock Margin="0,6,0,0" Text="Pairing Code:" />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBox
                                        x:Name="PairingCodeBox"
                                        FontFamily="Consolas"
                                        TextChanged="PairingCodeBox_TextChanged" />
                                    <Button
                                        x:Name="PairNewDeviceButton"
                                        Grid.Column="1"
                                        Margin="4,0,0,0"
                                        HorizontalAlignment="Right"
                                        Click="PairNewDeviceButton_Click"
                                        Content="Pair"
                                        IsEnabled="False" />
                                </Grid>
                                <Button
                                    x:Name="ConnectNewDeviceButton"
                                    Margin="0,6,0,0"
                                    HorizontalAlignment="Center"
                                    Click="ConnectNewDeviceButton_Click"
                                    Content="Connect"
                                    IsEnabled="False" />
                            </StackPanel>
                        </StackPanel>
                        <ui:ListView
                            x:Name="DevicesList"
                            Grid.Row="2"
                            IsSelectionEnabled="False"
                            ItemContainerStyle="{StaticResource DeviceLightStyle}"
                            ItemsSource="{Binding}"
                            MouseDown="DevicesList_MouseDown" />
                    </Grid>
                </Border>
            </ui:SplitView.Pane>
        </ui:SplitView>
        <ui:SplitView
            x:Name="SettingsSplitView"
            FocusVisualStyle="{x:Null}"
            OpenPaneLength="350"
            PanePlacement="Right">
            <ui:SplitView.Resources>
                <Style TargetType="Separator">
                    <Setter Property="Width" Value="300" />
                    <Setter Property="Margin" Value="0,0,20,6" />
                    <Setter Property="HorizontalAlignment" Value="Center" />
                </Style>
            </ui:SplitView.Resources>
            <ui:SplitView.Pane>
                <Border BorderBrush="Gray" BorderThickness="1,1,0,0">
                    <Grid Margin="24,8">
                        <Grid.RowDefinitions>
                            <RowDefinition Height="48" />
                            <RowDefinition Height="*" />
                        </Grid.RowDefinitions>
                        <TextBlock FontSize="24" Text="Settings" />
                        <ScrollViewer Grid.Row="1">
                            <StackPanel HorizontalAlignment="Left">
                                <TextBlock Text="Theme" />
                                <StackPanel Margin="0,6,0,15">
                                    <RadioButton
                                        x:Name="LightThemeRadioButton"
                                        Checked="LightThemeRadioButton_Checked"
                                        Content="Light" />
                                    <RadioButton
                                        x:Name="DarkThemeRadioButton"
                                        Checked="DarkThemeRadioButton_Checked"
                                        Content="Dark" />
                                </StackPanel>
                                <Separator />
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="120" />
                                        <ColumnDefinition />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock VerticalAlignment="Center" Text="Default Folder" />
                                    <Button
                                        x:Name="ChangeDefaultFolderButton"
                                        Grid.Column="1"
                                        Click="ChangeDefaultFolderButton_Click"
                                        Content="&#xE70F;"
                                        FontFamily="Segoe MDL2 Assets"
                                        ToolTip="Change" />
                                </Grid>
                                <TextBlock
                                    x:Name="DefaultFolderBlock"
                                    Margin="0,6,0,15"
                                    FontFamily="Consolas"
                                    Text="[not set]" />
                                <Separator />
                                <TextBlock Text="File Double-Click Behavior" />
                                <StackPanel Margin="0,6,0,15">
                                    <CheckBox
                                        x:Name="CopyOnDoubleClickCheckBox"
                                        Checked="CopyOnDoubleClickCheckBox_Checked"
                                        Content="Copy To Default Folder" />
                                </StackPanel>
                                <Separator />
                                <TextBlock Text="Connection" />
                                <StackPanel Margin="0,6,0,15">
                                    <CheckBox
                                        x:Name="RememberIpCheckBox"
                                        Click="RememberIpCheckBox_Click"
                                        Content="Remember Last IP" />
                                    <CheckBox
                                        x:Name="RememberPortCheckBox"
                                        Click="RememberPortCheckBox_Click"
                                        Content="Remember Last Port" />
                                    <CheckBox
                                        x:Name="AutoOpenCheckBox"
                                        Click="AutoOpenCheckBox_Click"
                                        Content="Automatically Open for Browsing" />
                                </StackPanel>
                            </StackPanel>
                        </ScrollViewer>
                    </Grid>
                </Border>
            </ui:SplitView.Pane>
        </ui:SplitView>
    </Grid>
</Window>
