<UserControl
    x:Class="ADB_Explorer.Controls.ExplorerPageHeader"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:converters="clr-namespace:ADB_Explorer.Converters"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:emoji="clr-namespace:Emoji.Wpf;assembly=Emoji.Wpf"
    xmlns:helpers="clr-namespace:ADB_Explorer.Helpers"
    xmlns:local="clr-namespace:ADB_Explorer.Controls"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="clr-namespace:ADB_Explorer.Models"
    xmlns:strings="clr-namespace:ADB_Explorer.Strings"
    xmlns:sys="clr-namespace:System;assembly=System.Runtime"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    xmlns:views="clr-namespace:ADB_Explorer.Views"
    d:DesignHeight="450"
    d:DesignWidth="800"
    mc:Ignorable="d">
    <UserControl.Resources>
        <sys:Int16 x:Key="FontSize">13</sys:Int16>
        <CollectionViewSource x:Key="FileListView" Source="{Binding Source={x:Static Member=models:Data.DirList}, Path=FileList}" />
        <local:AdbContextMenu x:Key="RowContextMenu" Style="{StaticResource ExplorerContextMenuStyle}" />
        <converters:StringFormatConverter x:Key="StringFormatConverter" />
        <Style
            x:Key="DataGridCellStyle"
            BasedOn="{StaticResource BaseCellStyle}"
            TargetType="{x:Type DataGridCell}">
            <EventSetter Event="RequestBringIntoView" Handler="DataGridCell_RequestBringIntoView" />
            <EventSetter Event="PreviewMouseDown" Handler="DataGridCell_PreviewMouseDown" />
            <EventSetter Event="MouseUp" Handler="DataGridCell_MouseUp" />
        </Style>
        <Style
            x:Key="RowStyle"
            BasedOn="{StaticResource BaseRowStyle}"
            TargetType="DataGridRow">
            <Setter Property="ContextMenu" Value="{StaticResource RowContextMenu}" />
            <EventSetter Event="MouseDown" Handler="DataGridRow_MouseDown" />
            <EventSetter Event="MouseDoubleClick" Handler="DataGridRow_MouseDoubleClick" />
            <EventSetter Event="KeyDown" Handler="DataGridRow_KeyDown" />
            <EventSetter Event="Drop" Handler="DataGridRow_Drop" />
            <EventSetter Event="MouseUp" Handler="DataGridCell_MouseUp" />
            <EventSetter Event="DragOver" Handler="ExplorerGrid_DragOver" />
        </Style>
        <DataTemplate x:Key="LogicalDriveTemplate">
            <views:LogicalDriveControl />
        </DataTemplate>
        <DataTemplate x:Key="VirtualDriveTemplate">
            <views:VirtualDriveControl />
        </DataTemplate>
        <helpers:DriveTemplateSelector
            x:Key="DriveTemplateSelector"
            LogicalDriveTemplate="{StaticResource LogicalDriveTemplate}"
            VirtualDriveTemplate="{StaticResource VirtualDriveTemplate}" />
        <Style
            x:Key="DriveListViewStyle"
            BasedOn="{StaticResource ListViewStyle}"
            TargetType="ui:ListView">
            <Setter Property="SelectionMode" Value="Single" />
            <Setter Property="ItemTemplateSelector" Value="{StaticResource DriveTemplateSelector}" />
            <Setter Property="ItemContainerStyle" Value="{StaticResource DriveContainerStyle}" />
        </Style>
    </UserControl.Resources>
    <Grid>
        <!--  Background="{DynamicResource ApplicationBackgroundBrush}"  -->
        <ScrollViewer Style="{StaticResource DriveViewScrollViewerStyle}">
            <StackPanel>
                <Expander
                    Margin="4"
                    helpers:ExpanderHelper.IsTransparent="True"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_SAVED_LOCATIONS}}"
                    IsExpanded="{Binding Source={x:Static Member=models:Data.Settings}, Path=HomeLocationsExpanded, Mode=TwoWay}">
                    <ui:ListView x:Name="HomeSavedLocationsList" Style="{StaticResource HomeSavedLocationsListStyle}" />
                </Expander>
                <Expander
                    Margin="4"
                    helpers:ExpanderHelper.IsTransparent="True"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_BUTTON_DRIVES}}"
                    IsExpanded="True">
                    <ui:ListView
                        x:Name="DriveList"
                        HorizontalAlignment="Stretch"
                        Style="{StaticResource DriveListViewStyle}">
                        <ui:ListView.ItemsPanel>
                            <ItemsPanelTemplate>
                                <WrapPanel Width="{Binding RelativeSource={RelativeSource AncestorType=ui:ListView}, Path=ActualWidth}" />
                            </ItemsPanelTemplate>
                        </ui:ListView.ItemsPanel>
                    </ui:ListView>
                </Expander>
            </StackPanel>
        </ScrollViewer>
        <ui:DataGrid
            x:Name="ExplorerGrid"
            helpers:SelectionHelper.CurrentSelectedIndex="-1"
            helpers:SelectionHelper.FirstSelectedIndex="-1"
            helpers:SelectionHelper.SelectionInProgress="False"
            AutoGenerateColumns="False"
            Background="Transparent"
            CanUserResizeRows="False"
            CellStyle="{StaticResource DataGridCellStyle}"
            ColumnHeaderStyle="{StaticResource DataGridColumnHeaderStyle}"
            ContextMenu="{StaticResource RowContextMenu}"
            ContextMenuClosing="ExplorerGrid_ContextMenuClosing"
            ContextMenuOpening="ExplorerGrid_ContextMenuOpening"
            DragOver="ExplorerGrid_DragOver"
            Drop="DataGridRow_Drop"
            GridLinesVisibility="None"
            HeadersVisibility="Column"
            IsReadOnly="False"
            ItemsSource="{Binding Source={StaticResource FileListView}, NotifyOnSourceUpdated=True}"
            KeyboardNavigation.TabNavigation="Once"
            MouseDown="ExplorerGrid_MouseDown"
            MouseMove="ExplorerGrid_MouseMove"
            RowStyle="{StaticResource RowStyle}"
            SelectionChanged="ExplorerGrid_SelectionChanged"
            SelectionMode="Extended"
            SelectionUnit="FullRow"
            Sorting="ExplorerGrid_Sorting"
            Style="{StaticResource ExplorerGridStyle}">
            <ui:DataGrid.Columns>
                <DataGridTemplateColumn
                    x:Name="IconColumn"
                    MaxWidth="24"
                    CanUserResize="False"
                    CellTemplate="{StaticResource FileIconTemplate}"
                    IsReadOnly="True">
                    <DataGridTemplateColumn.HeaderStyle>
                        <Style BasedOn="{StaticResource DataGridColumnHeaderStyle}" TargetType="DataGridColumnHeader">
                            <Setter Property="ToolTip" Value="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_ICON}}" />
                        </Style>
                    </DataGridTemplateColumn.HeaderStyle>
                </DataGridTemplateColumn>
                <DataGridTemplateColumn
                    x:Name="NameColumn"
                    Width="300"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_NAME}}"
                    IsReadOnly="{Binding Source={x:Static Member=models:Data.FileActions}, Path=NameReadOnly}"
                    SortMemberPath="FullName">
                    <DataGridTemplateColumn.CellEditingTemplate>
                        <DataTemplate>
                            <ui:TextBox
                                KeyDown="NameColumnEdit_KeyDown"
                                Loaded="NameColumnEdit_Loaded"
                                LostFocus="NameColumnEdit_LostFocus"
                                Style="{StaticResource FileNameEditingElementStyle}"
                                TextChanged="NameColumnEdit_TextChanged" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellEditingTemplate>
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <emoji:TextBlock Style="{StaticResource DirectoryGridCellStyle}" Text="{Binding DisplayName}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn
                    x:Name="OriginalPath"
                    Width="180"
                    Binding="{Binding TrashIndex.ParentPath}"
                    ElementStyle="{StaticResource DirectoryGridCellStyle}"
                    FontSize="{Binding Source={StaticResource FontSize}}"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_ORIGINAL_LOCATION}}"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    x:Name="DateColumn"
                    Width="Auto"
                    FontSize="{Binding Source={StaticResource FontSize}}"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_DATE_MODIFIED}}"
                    IsReadOnly="True"
                    SortMemberPath="ModifiedTime">
                    <DataGridTextColumn.ElementStyle>
                        <Style BasedOn="{StaticResource DirectoryGridCellStyle}" TargetType="TextBlock">
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Setter Property="Text" Value="{Binding ModifiedTimeString}" />
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Type}" Value="File">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                                <DataTrigger Binding="{Binding Type}" Value="Folder">
                                    <Setter Property="Visibility" Value="Visible" />
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTemplateColumn
                    x:Name="TypeColumn"
                    Width="150"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_TYPE}}"
                    IsReadOnly="True"
                    SortMemberPath="TypeName">
                    <DataGridTemplateColumn.CellTemplate>
                        <DataTemplate>
                            <emoji:TextBlock
                                FontSize="{Binding Source={StaticResource FontSize}}"
                                Style="{StaticResource DirectoryGridCellStyle}"
                                Text="{Binding TypeName}" />
                        </DataTemplate>
                    </DataGridTemplateColumn.CellTemplate>
                </DataGridTemplateColumn>
                <DataGridTextColumn
                    x:Name="SizeColumn"
                    Width="Auto"
                    FontSize="{Binding Source={StaticResource FontSize}}"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_SIZE}}"
                    IsReadOnly="True"
                    SortMemberPath="Size">
                    <DataGridTextColumn.ElementStyle>
                        <Style BasedOn="{StaticResource DirectoryGridCellStyle}" TargetType="TextBlock">
                            <Setter Property="Text" Value="{Binding SizeString}" />
                            <Setter Property="HorizontalAlignment" Value="Right" />
                            <Setter Property="Visibility" Value="Collapsed" />
                            <Style.Triggers>
                                <MultiDataTrigger>
                                    <MultiDataTrigger.Conditions>
                                        <Condition Binding="{Binding Type}" Value="File" />
                                        <Condition Binding="{Binding IsLink}" Value="False" />
                                    </MultiDataTrigger.Conditions>
                                    <Setter Property="Visibility" Value="Visible" />
                                </MultiDataTrigger>
                            </Style.Triggers>
                        </Style>
                    </DataGridTextColumn.ElementStyle>
                </DataGridTextColumn>
                <DataGridTextColumn
                    x:Name="OriginalDate"
                    Width="Auto"
                    Binding="{Binding TrashIndex.ModifiedTimeString}"
                    ElementStyle="{StaticResource DirectoryGridCellStyle}"
                    FontSize="{Binding Source={StaticResource FontSize}}"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_DATE_DELETED}}"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    x:Name="PackageName"
                    Width="400"
                    Binding="{Binding Name}"
                    ElementStyle="{StaticResource ExplorerGridCellStyle}"
                    FontSize="{Binding Source={StaticResource FontSize}}"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_NAME}}"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    x:Name="PackageType"
                    Width="100"
                    Binding="{Binding Type}"
                    ElementStyle="{StaticResource ExplorerGridCellStyle}"
                    FontSize="{Binding Source={StaticResource FontSize}}"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_TYPE}}"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    x:Name="PackageUid"
                    Width="100"
                    Binding="{Binding Uid}"
                    ElementStyle="{StaticResource ExplorerGridCellStyle}"
                    FontSize="{Binding Source={StaticResource FontSize}}"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_USER_ID}}"
                    IsReadOnly="True" />
                <DataGridTextColumn
                    x:Name="PackageVersion"
                    Width="100"
                    Binding="{Binding Version}"
                    ElementStyle="{StaticResource ExplorerGridCellStyle}"
                    FontSize="{Binding Source={StaticResource FontSize}}"
                    Header="{Binding Source={x:Static Member=strings:Resources.S_COLUMN_VERSION}}"
                    IsReadOnly="True" />
            </ui:DataGrid.Columns>
        </ui:DataGrid>
    </Grid>
</UserControl>
